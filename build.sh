#!/bin/bash

# not including start.js
files="instrument.js note.js player.js sequencer.js music.js thread.js ui.js main.js screen0.js screen1.js"
dest=build/all.js
ndest="$dest.a"

cat start.js > "$dest"
echo >> "$dest"

:> "$ndest"

for file in $files
do
	cat "$file" >> "$ndest"
	echo >> "$ndest"
done

minify --mangle --simplify --booleans --builtIns --consecutiveAdds --evaluate --infinity --mergeVars --numericLiterals --propertyLiterals --removeUndefined --undefinedToVoid "$ndest" >> "$dest"

# a="$(xxd -p $dest | tr -d '\n' | sed -E 's/(..)/\\x\1/g')"

cat << EOF > build/out.js
/**
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 */

var w = (0, eval)("window");
w.PJSCodeInjector.prototype.exec = new w.Function("_", "env", $(jq -aRs . $dest));
w.top.postMessage(w.JSON.stringify({ code: "\n" }), "*");

/**
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 * Hi
 */
EOF

echo Done
